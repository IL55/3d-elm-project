dependencies:
  cache_directories:
    - node_modules
    - elm-stuff
  pre:
    - npm i -g elm && npm i && elm package install --yes

machine:
  environment:
    NODE_ENV: test
  node:
    version: 6.7.0

test:
  post:
    - npm run build
    - sed -i -r '/^dist\/?\s*$/d' .gitignore
    - git config user.name "igor@salsitasoft.com"
    - git config user.email "igor@salsitasoft.com"
    - git checkout -b gh-pages
    - git --no-pager diff .gitignore
    - git status
    - git add -A
    - git status
    - git commit -m "build"
    - git log -n3
    - git push -f origin gh-pages

deployment:
  prod:
    branch: master
    commands:
      - git push -f git@heroku.com:travy-urala.git ${CIRCLE_BRANCH}:master

